{"version":3,"sources":["../../src/models/buildGlobalModel.ts"],"sourcesContent":["import mongoose from 'mongoose'\n\nimport type { MongooseAdapter } from '../index.js'\nimport type { GlobalModel } from '../types.js'\n\nimport { getBuildQueryPlugin } from '../queries/getBuildQueryPlugin.js'\nimport { buildSchema } from './buildSchema.js'\n\nexport const buildGlobalModel = (adapter: MongooseAdapter): GlobalModel | null => {\n  if (adapter.payload.config.globals && adapter.payload.config.globals.length > 0) {\n    const globalsSchema = new mongoose.Schema(\n      {},\n      { discriminatorKey: 'globalType', minimize: false, timestamps: true },\n    )\n\n    globalsSchema.plugin(getBuildQueryPlugin())\n\n    const Globals = adapter.connection.model(\n      'globals',\n      globalsSchema,\n      'globals',\n    ) as unknown as GlobalModel\n\n    Object.values(adapter.payload.config.globals).forEach((globalConfig) => {\n      const globalSchema = buildSchema({\n        buildSchemaOptions: {\n          options: {\n            minimize: false,\n          },\n        },\n        configFields: globalConfig.fields,\n        payload: adapter.payload,\n      })\n      Globals.discriminator(globalConfig.slug, globalSchema)\n    })\n\n    return Globals\n  }\n\n  return null\n}\n"],"names":["mongoose","getBuildQueryPlugin","buildSchema","buildGlobalModel","adapter","payload","config","globals","length","globalsSchema","Schema","discriminatorKey","minimize","timestamps","plugin","Globals","connection","model","Object","values","forEach","globalConfig","globalSchema","buildSchemaOptions","options","configFields","fields","discriminator","slug"],"mappings":"AAAA,OAAOA,cAAc,WAAU;AAK/B,SAASC,mBAAmB,QAAQ,oCAAmC;AACvE,SAASC,WAAW,QAAQ,mBAAkB;AAE9C,OAAO,MAAMC,mBAAmB,CAACC;IAC/B,IAAIA,QAAQC,OAAO,CAACC,MAAM,CAACC,OAAO,IAAIH,QAAQC,OAAO,CAACC,MAAM,CAACC,OAAO,CAACC,MAAM,GAAG,GAAG;QAC/E,MAAMC,gBAAgB,IAAIT,SAASU,MAAM,CACvC,CAAC,GACD;YAAEC,kBAAkB;YAAcC,UAAU;YAAOC,YAAY;QAAK;QAGtEJ,cAAcK,MAAM,CAACb;QAErB,MAAMc,UAAUX,QAAQY,UAAU,CAACC,KAAK,CACtC,WACAR,eACA;QAGFS,OAAOC,MAAM,CAACf,QAAQC,OAAO,CAACC,MAAM,CAACC,OAAO,EAAEa,OAAO,CAAC,CAACC;YACrD,MAAMC,eAAepB,YAAY;gBAC/BqB,oBAAoB;oBAClBC,SAAS;wBACPZ,UAAU;oBACZ;gBACF;gBACAa,cAAcJ,aAAaK,MAAM;gBACjCrB,SAASD,QAAQC,OAAO;YAC1B;YACAU,QAAQY,aAAa,CAACN,aAAaO,IAAI,EAAEN;QAC3C;QAEA,OAAOP;IACT;IAEA,OAAO;AACT,EAAC"}
{"version":3,"sources":["../../src/utilities/handleError.ts"],"sourcesContent":["import type { PayloadRequest } from 'payload'\n\nimport { ValidationError } from 'payload'\n\nfunction extractFieldFromMessage(message: string) {\n  // eslint-disable-next-line regexp/no-super-linear-backtracking\n  const match = message.match(/index:\\s*(.*?)_/)\n  if (match && match[1]) {\n    return match[1] // e.g., returns \"email\" from \"index: email_1\"\n  }\n  return null\n}\n\nexport const handleError = ({\n  collection,\n  error,\n  global,\n  req,\n}: {\n  collection?: string\n  error: unknown\n  global?: string\n  req?: Partial<PayloadRequest>\n}) => {\n  if (!error || typeof error !== 'object') {\n    throw error\n  }\n\n  // Handle uniqueness error from MongoDB\n  if ('code' in error && error.code === 11000) {\n    let path: null | string = null\n\n    if ('keyValue' in error && error.keyValue && typeof error.keyValue === 'object') {\n      path = Object.keys(error.keyValue)[0] ?? ''\n    } else if ('message' in error && typeof error.message === 'string') {\n      path = extractFieldFromMessage(error.message)\n    }\n\n    throw new ValidationError(\n      {\n        collection,\n        errors: [\n          {\n            message: req?.t ? req.t('error:valueMustBeUnique') : 'Value must be unique',\n            path: path ?? '',\n          },\n        ],\n        global,\n      },\n      req?.t,\n    )\n  }\n\n  // eslint-disable-next-line @typescript-eslint/only-throw-error\n  throw error\n}\n"],"names":["ValidationError","extractFieldFromMessage","message","match","handleError","collection","error","global","req","code","path","keyValue","Object","keys","errors","t"],"mappings":"AAEA,SAASA,eAAe,QAAQ,UAAS;AAEzC,SAASC,wBAAwBC,OAAe;IAC9C,+DAA+D;IAC/D,MAAMC,QAAQD,QAAQC,KAAK,CAAC;IAC5B,IAAIA,SAASA,KAAK,CAAC,EAAE,EAAE;QACrB,OAAOA,KAAK,CAAC,EAAE,CAAC,8CAA8C;;IAChE;IACA,OAAO;AACT;AAEA,OAAO,MAAMC,cAAc,CAAC,EAC1BC,UAAU,EACVC,KAAK,EACLC,MAAM,EACNC,GAAG,EAMJ;IACC,IAAI,CAACF,SAAS,OAAOA,UAAU,UAAU;QACvC,MAAMA;IACR;IAEA,uCAAuC;IACvC,IAAI,UAAUA,SAASA,MAAMG,IAAI,KAAK,OAAO;QAC3C,IAAIC,OAAsB;QAE1B,IAAI,cAAcJ,SAASA,MAAMK,QAAQ,IAAI,OAAOL,MAAMK,QAAQ,KAAK,UAAU;YAC/ED,OAAOE,OAAOC,IAAI,CAACP,MAAMK,QAAQ,CAAC,CAAC,EAAE,IAAI;QAC3C,OAAO,IAAI,aAAaL,SAAS,OAAOA,MAAMJ,OAAO,KAAK,UAAU;YAClEQ,OAAOT,wBAAwBK,MAAMJ,OAAO;QAC9C;QAEA,MAAM,IAAIF,gBACR;YACEK;YACAS,QAAQ;gBACN;oBACEZ,SAASM,KAAKO,IAAIP,IAAIO,CAAC,CAAC,6BAA6B;oBACrDL,MAAMA,QAAQ;gBAChB;aACD;YACDH;QACF,GACAC,KAAKO;IAET;IAEA,+DAA+D;IAC/D,MAAMT;AACR,EAAC"}
{"version":3,"sources":["../src/createGlobal.ts"],"sourcesContent":["import type { CreateOptions } from 'mongoose'\n\nimport { type CreateGlobal } from 'payload'\n\nimport type { MongooseAdapter } from './index.js'\n\nimport { getGlobal } from './utilities/getEntity.js'\nimport { getSession } from './utilities/getSession.js'\nimport { transform } from './utilities/transform.js'\n\nexport const createGlobal: CreateGlobal = async function createGlobal(\n  this: MongooseAdapter,\n  { slug: globalSlug, data, req, returning },\n) {\n  const { globalConfig, Model } = getGlobal({ adapter: this, globalSlug })\n\n  if (!data.createdAt) {\n    ;(data as any).createdAt = new Date().toISOString()\n  }\n\n  transform({\n    adapter: this,\n    data,\n    fields: globalConfig.fields,\n    globalSlug,\n    operation: 'write',\n  })\n\n  const options: CreateOptions = {\n    session: await getSession(this, req),\n    // Timestamps are manually added by the write transform\n    timestamps: false,\n  }\n\n  let [result] = (await Model.create([data], options)) as any\n  if (returning === false) {\n    return null\n  }\n\n  result = result.toObject()\n\n  transform({\n    adapter: this,\n    data: result,\n    fields: globalConfig.fields,\n    operation: 'read',\n  })\n\n  return result\n}\n"],"names":["getGlobal","getSession","transform","createGlobal","slug","globalSlug","data","req","returning","globalConfig","Model","adapter","createdAt","Date","toISOString","fields","operation","options","session","timestamps","result","create","toObject"],"mappings":"AAMA,SAASA,SAAS,QAAQ,2BAA0B;AACpD,SAASC,UAAU,QAAQ,4BAA2B;AACtD,SAASC,SAAS,QAAQ,2BAA0B;AAEpD,OAAO,MAAMC,eAA6B,eAAeA,aAEvD,EAAEC,MAAMC,UAAU,EAAEC,IAAI,EAAEC,GAAG,EAAEC,SAAS,EAAE;IAE1C,MAAM,EAAEC,YAAY,EAAEC,KAAK,EAAE,GAAGV,UAAU;QAAEW,SAAS,IAAI;QAAEN;IAAW;IAEtE,IAAI,CAACC,KAAKM,SAAS,EAAE;;QACjBN,KAAaM,SAAS,GAAG,IAAIC,OAAOC,WAAW;IACnD;IAEAZ,UAAU;QACRS,SAAS,IAAI;QACbL;QACAS,QAAQN,aAAaM,MAAM;QAC3BV;QACAW,WAAW;IACb;IAEA,MAAMC,UAAyB;QAC7BC,SAAS,MAAMjB,WAAW,IAAI,EAAEM;QAChC,uDAAuD;QACvDY,YAAY;IACd;IAEA,IAAI,CAACC,OAAO,GAAI,MAAMV,MAAMW,MAAM,CAAC;QAACf;KAAK,EAAEW;IAC3C,IAAIT,cAAc,OAAO;QACvB,OAAO;IACT;IAEAY,SAASA,OAAOE,QAAQ;IAExBpB,UAAU;QACRS,SAAS,IAAI;QACbL,MAAMc;QACNL,QAAQN,aAAaM,MAAM;QAC3BC,WAAW;IACb;IAEA,OAAOI;AACT,EAAC"}